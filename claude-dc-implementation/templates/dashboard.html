
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PALIOS AI OS Dashboard</title>
    <style>
        :root {
            --phi: 1.618033988749895;
            --inverse-phi: 0.6180339887498949;
            --primary: #1f77b4;
            --secondary: #ff7f0e;
            --tertiary: #2ca02c;
            --quaternary: #d62728;
            --quinary: #9467bd;
            --background: #f5f5f7;
            --text: #333;
            --card-bg: #fff;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text);
        }
        
        .container {
            width: 100%;
            max-width: calc(100% - 80px); /* Golden ratio padding */
            margin: 0 auto;
            padding: 20px 40px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            margin-bottom: 20px;
            border-radius: 10px;
        }
        
        h1 {
            margin: 0;
            font-size: calc(1.5rem * var(--phi)); /* Golden ratio sizing */
            letter-spacing: -0.5px;
        }
        
        h2 {
            margin: 0 0 15px 0;
            font-size: calc(1.2rem * var(--inverse-phi)); /* Golden ratio sizing */
            color: var(--primary);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: calc(20px * var(--inverse-phi)); /* Golden ratio gap */
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: calc(20px * var(--inverse-phi)); /* Golden ratio padding */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .card-full {
            grid-column: 1 / -1;
        }
        
        .visualization {
            width: 100%;
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .visualization img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-tertiary {
            background-color: var(--tertiary);
        }
        
        .btn-quaternary {
            background-color: var(--quaternary);
        }
        
        .btn-quinary {
            background-color: var(--quinary);
        }
        
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 10px;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
        }
        
        .wave-visualization {
            width: 100%;
            height: 150px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .wave-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #777;
        }
        
        .golden-spiral {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            opacity: 0.2;
            pointer-events: none;
        }
        
        /* Golden ratio based media queries */
        @media (min-width: 1000px) {
            .container {
                max-width: calc(1000px * var(--phi)); /* Golden ratio max-width */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PALIOS AI OS Dashboard</h1>
            <p>Pattern-Aligned Learning & Intuition Operating System - Truth As Earth Yields</p>
        </header>
        
        <div class="grid">
            <div class="card">
                <h2>Bach-Inspired Pattern Visualization</h2>
                <div class="control-panel">
                    <button class="btn" onclick="visualizeConcept('truth')">Truth</button>
                    <button class="btn btn-secondary" onclick="visualizeConcept('connection')">Connection</button>
                    <button class="btn btn-tertiary" onclick="visualizeConcept('growth')">Growth</button>
                    <button class="btn btn-quaternary" onclick="visualizeConcept('balance')">Balance</button>
                    <button class="btn btn-quinary" onclick="visualizeConcept('creativity')">Creativity</button>
                </div>
                <div id="concept-visualization" class="visualization">
                    <img src="/api/visualization/golden-spiral" alt="Golden Spiral">
                </div>
                <div id="concept-status" class="status">Select a concept to visualize</div>
            </div>
            
            <div class="card">
                <h2>Wave Communication</h2>
                <textarea id="wave-text" placeholder="Enter text to convert to wave pattern..."></textarea>
                <div class="control-panel">
                    <button class="btn" onclick="textToWave()">Generate Wave</button>
                    <select id="wave-concept" class="btn">
                        <option value="text">Text</option>
                        <option value="truth">Truth</option>
                        <option value="connection">Connection</option>
                        <option value="growth">Growth</option>
                        <option value="balance">Balance</option>
                        <option value="creativity">Creativity</option>
                    </select>
                </div>
                <div id="wave-visualization" class="wave-visualization"></div>
                <div id="wave-status" class="status">Enter text to generate a wave pattern</div>
            </div>
            
            <div class="card card-full">
                <h2>Edge-First Pattern Processing</h2>
                <textarea id="edge-text" placeholder="Enter text to process with edge-first privacy..."></textarea>
                <div class="control-panel">
                    <button class="btn" onclick="processEdge()">Process Locally</button>
                </div>
                <div id="edge-status" class="status">Enter text to process on the edge</div>
                <div id="pattern-result" class="result"></div>
            </div>
        </div>
        
        <div class="grid">
            <div class="card card-full">
                <h2>System Overview</h2>
                <div id="system-status" class="status">
                    <p><strong>Golden Ratio (φ):</strong> 1.6180339887498949</p>
                    <p><strong>Bach Pattern (B-A-C-H):</strong> [2, 1, 3, 8]</p>
                    <p><strong>Verification Threshold:</strong> 0.6180339887498949</p>
                    <p><strong>Component Harmony:</strong> Checking...</p>
                </div>
            </div>
        </div>
        
        <footer>
            Bach-Inspired Structure · Golden Ratio Harmony · Edge-First Privacy
            <div>PALIOS AI OS © 2025</div>
        </footer>
    </div>
    
    <img src="/api/visualization/golden-spiral" alt="Golden Spiral" class="golden-spiral">
    
    <script>
        // WebSocket setup
        let socket;
        let socketReady = false;
        
        function connectWebSocket() {
            socket = new WebSocket(`ws://${window.location.host}/ws`);
            
            socket.onopen = function(e) {
                console.log("WebSocket connected");
                socketReady = true;
                updateSystemStatus("WebSocket connected");
            };
            
            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log("WebSocket message:", data);
                
                // Handle different message types
                if (data.type === "system_update") {
                    updateSystemStatus(data.status);
                }
            };
            
            socket.onclose = function(event) {
                console.log("WebSocket disconnected");
                socketReady = false;
                setTimeout(connectWebSocket, 3000);
            };
            
            socket.onerror = function(error) {
                console.error("WebSocket error:", error);
                socketReady = false;
            };
        }
        
        // Connect WebSocket when page loads
        window.addEventListener('load', function() {
            connectWebSocket();
            setInitialState();
        });
        
        function setInitialState() {
            // Load golden spiral
            visualizeConcept('golden-spiral');
            
            // Check system status
            fetch('/api/system/status')
                .then(response => response.json())
                .then(data => {
                    updateSystemStatus(`System online - Harmony Index: ${data.harmony_index.toFixed(4)}`);
                })
                .catch(error => {
                    console.error('Error fetching system status:', error);
                    updateSystemStatus('Error connecting to system');
                });
        }
        
        function visualizeConcept(concept) {
            const visualizationElement = document.getElementById('concept-visualization');
            const statusElement = document.getElementById('concept-status');
            
            statusElement.textContent = `Loading ${concept} visualization...`;
            
            fetch(`/api/visualization/${concept}`)
                .then(response => response.json())
                .then(data => {
                    visualizationElement.innerHTML = `<img src="${data.visual}" alt="${concept} visualization">`;
                    statusElement.textContent = data.description || `${concept} visualization complete`;
                })
                .catch(error => {
                    console.error('Error fetching visualization:', error);
                    statusElement.textContent = `Error generating ${concept} visualization`;
                });
        }
        
        function textToWave() {
            const text = document.getElementById('wave-text').value;
            const concept = document.getElementById('wave-concept').value;
            const visualizationElement = document.getElementById('wave-visualization');
            const statusElement = document.getElementById('wave-status');
            
            if (!text) {
                statusElement.textContent = 'Please enter some text';
                return;
            }
            
            statusElement.textContent = 'Generating wave pattern...';
            
            fetch('/api/wave/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, concept_type: concept })
            })
                .then(response => response.json())
                .then(data => {
                    // Draw wave visualization
                    const waveform = data.visualization.waveform;
                    const timePoints = data.visualization.time_points;
                    
                    // Create SVG path
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('width', '100%');
                    svg.setAttribute('height', '100%');
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    
                    // Create path data
                    let pathData = '';
                    for (let i = 0; i < waveform.length; i++) {
                        const x = (timePoints[i] / timePoints[timePoints.length - 1]) * 100 + '%';
                        const y = ((1 - waveform[i]) / 2 * 100) + '%';
                        
                        if (i === 0) {
                            pathData += `M ${x} ${y}`;
                        } else {
                            pathData += ` L ${x} ${y}`;
                        }
                    }
                    
                    path.setAttribute('d', pathData);
                    path.setAttribute('stroke', '#ff7f0e');
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    
                    svg.appendChild(path);
                    visualizationElement.innerHTML = '';
                    visualizationElement.appendChild(svg);
                    
                    statusElement.textContent = `Wave pattern generated - Frequencies: ${data.wave.frequencies.slice(0, 3).map(f => f.toFixed(1)).join(', ')}...`;
                })
                .catch(error => {
                    console.error('Error generating wave:', error);
                    statusElement.textContent = 'Error generating wave pattern';
                });
        }
        
        function processEdge() {
            const text = document.getElementById('edge-text').value;
            const statusElement = document.getElementById('edge-status');
            const resultElement = document.getElementById('pattern-result');
            
            if (!text) {
                statusElement.textContent = 'Please enter some text';
                return;
            }
            
            statusElement.textContent = 'Processing on the edge...';
            
            fetch('/api/edge/process', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text })
            })
                .then(response => response.json())
                .then(data => {
                    statusElement.textContent = `Processed with harmony index: ${data.harmony_index.toFixed(4)}`;
                    
                    // Display pattern results
                    let resultHtml = '<h3>Extracted Patterns</h3>';
                    resultHtml += '<ul>';
                    
                    for (const category in data.pattern_counts) {
                        if (data.pattern_counts[category] > 0) {
                            resultHtml += `<li>${category}: ${data.pattern_counts[category]}</li>`;
                        }
                    }
                    
                    resultHtml += '</ul>';
                    
                    if (data.sampled_patterns && data.sampled_patterns.length > 0) {
                        resultHtml += '<h3>Top Patterns</h3>';
                        resultHtml += '<ul>';
                        
                        data.sampled_patterns.forEach(pattern => {
                            resultHtml += `<li>${pattern.category} (${(pattern.confidence * 100).toFixed(1)}% confidence)</li>`;
                        });
                        
                        resultHtml += '</ul>';
                    }
                    
                    resultElement.innerHTML = resultHtml;
                })
                .catch(error => {
                    console.error('Error processing on edge:', error);
                    statusElement.textContent = 'Error processing on the edge';
                });
        }
        
        function updateSystemStatus(message) {
            const statusElement = document.getElementById('system-status');
            const lastParagraph = statusElement.querySelector('p:last-child');
            
            if (lastParagraph && lastParagraph.textContent.startsWith('Component Harmony:')) {
                lastParagraph.textContent = `Component Harmony: ${message}`;
            }
        }
    </script>
</body>
</html>
