<!DOCTYPE html>
<html>
<head>
    <title>PALIOS-TAEY Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- Previous HTML content -->
    
    <script>
        // Set your API key here - in production this would be better secured
        const API_KEY = "test_key_123";
        
        // Previous JavaScript functions
        
        async function loadMemories() {
            try {
                const response = await fetch('/api/memory', {
                    headers: { 'X-API-Key': API_KEY }
                });
                const data = await response.json();
                
                if (response.ok) {
                    const memoriesList = document.getElementById('memories-list');
                    
                    if (!data.memories || data.memories.length === 0) {
                        memoriesList.textContent = 'No memories found';
                        return;
                    }
                    
                    memoriesList.innerHTML = '';
                    const table = document.createElement('table');
                    table.className = 'table table-sm';
                    
                    // Create header
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    ['ID', 'Content', 'Tier', 'Type'].forEach(text => {
                        const th = document.createElement('th');
                        th.textContent = text;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);
                    
                    // Create body
                    const tbody = document.createElement('tbody');
                    data.memories.forEach(memory => {
                        const row = document.createElement('tr');
                        
                        // ID column (truncated)
                        const idCell = document.createElement('td');
                        idCell.textContent = memory.memory_id.substring(0, 8) + '...';
                        row.appendChild(idCell);
                        
                        // Content column (truncated)
                        const contentCell = document.createElement('td');
                        contentCell.textContent = memory.content.substring(0, 30) + 
                            (memory.content.length > 30 ? '...' : '');
                        row.appendChild(contentCell);
                        
                        // Tier column
                        const tierCell = document.createElement('td');
                        tierCell.textContent = memory.tier;
                        row.appendChild(tierCell);
                        
                        // Type column
                        const typeCell = document.createElement('td');
                        const type = memory.metadata && memory.metadata.type 
                            ? memory.metadata.type 
                            : 'unknown';
                        typeCell.textContent = type;
                        row.appendChild(typeCell);
                        
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    
                    memoriesList.appendChild(table);
                } else {
                    document.getElementById('memories-list').textContent = 
                        ;
                }
            } catch (error) {
                document.getElementById('memories-list').textContent = 
                    ;
            }
        }
        
        async function storeMemory() {
            const content = document.getElementById('memory-content').value;
            if (!content) {
                document.getElementById('memory-result').textContent = 
                    'Please enter memory content';
                return;
            }
            
            const tier = document.getElementById('memory-tier').value;
            
            try {
                const response = await fetch('/api/memory', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({ 
                        content,
                        tier,
                        metadata: {
                            source: 'dashboard'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('memory-result').textContent = 
                        ;
                    document.getElementById('memory-content').value = '';
                    // Refresh memories after storing
                    loadMemories();
                } else {
                    document.getElementById('memory-result').textContent = 
                        ;
                }
            } catch (error) {
                document.getElementById('memory-result').textContent = 
                    ;
            }
        }
        
        // Initialize on page load
        window.onload = function() {
            checkHealth();
            loadModels();
            loadMemories();
        };
    </script>
</body>
</html>
